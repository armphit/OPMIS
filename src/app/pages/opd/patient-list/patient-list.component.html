<mat-tab-group (selectedTabChange)="onTabChange($event.index)">
  <mat-tab label="รายการยา">
    <div class="container-fluid pt-2">
      <div class="row">
        <div class="col-lg-6">
          <mat-form-field [hidden]="!dataSource">
            <mat-label>เลือกรายการแพ้ยา</mat-label>
            <mat-select
              [formControl]="nameFilter"
              (selectionChange)="setFocus()"
            >
              <mat-option value="">ทั้งหมด</mat-option>
              <mat-option value="Y">มีแพ้ยา</mat-option>
              <mat-option value="N">ไม่มีแพ้ยา</mat-option>
            </mat-select>
          </mat-form-field>

          <button
            [hidden]="!dataSource"
            type="button"
            matTooltip="Refresh"
            style="margin-left: 30px"
            class="btn btn-outline-primary btn-circle btn-md"
            (click)="
              getData();
              nameFilter.setValue('');
              idFilter.setValue('');
              setFocus()
            "
          >
            <i class="fas fa-sync-alt fa-lg"></i>
          </button>

          <div
            [hidden]="!dataSource || select == 'W8'"
            style="display: inline; margin-left: 50px"
          >
            <span style="font-size: 25px; font-weight: bold"
              >เช็คแพ้ยา : {{ checkAllergy.percen + "% " }}</span
            >
            <span>{{ checkAllergy.num + "/" + checkAllergy.len }}</span>
          </div>
        </div>
        <div class="col-lg-3">
          <mat-form-field>
            <mat-label>Select Site</mat-label>
            <mat-select [(ngModel)]="select" (ngModelChange)="changeFloor()">
              <mat-option value="W9">ห้องยาชั้น 1</mat-option>
              <mat-option value="W8">ห้องยาชั้น 2</mat-option>
              <mat-option value="W18">ห้องยาชั้น 3</mat-option>
              <mat-option value="W19">ห้องยา M - Park</mat-option>
              <mat-option value="W20">ห้องยา ER OPD</mat-option>
              <mat-option value="W21">ห้องยา ER IPD</mat-option>
              <mat-option value="W13">ห้องยา ตึกมะเร็ง</mat-option>
              <mat-option value="W11">ห้องยา รพ.หัวทะเล</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-lg-3">
          <mat-form-field
            class="example-full-width"
            style="float: right"
            [hidden]="!dataSource"
          >
            <input matInput [formControl]="idFilter" #input />
            <mat-placeholder>HN</mat-placeholder>
            <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <div class="row">
        <div class="col-lg-2">
          <mat-checkbox
            [hidden]="!dataSource"
            class="example-margin"
            color="primary"
            style="margin: 0px 0px 0px 30px"
            [matTooltip]="dataUser.print_ip"
            [(ngModel)]="checkprint"
            ><strong>PRINTER</strong></mat-checkbox
          >
        </div>

        <div class="col-lg-6" *ngIf="select !== ''">
          <mat-form-field class="example-form-field" style="float: left">
            <mat-label>เลือกวันที่</mat-label>
            <mat-date-range-input
              [formGroup]="campaignOne"
              [rangePicker]="picker1"
              [comparisonStart]="campaignOne.value.start"
              [comparisonEnd]="campaignOne.value.end"
            >
              <input
                matStartDate
                placeholder="วันที่เริ่มต้น"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="วันที่สิ้นสุด"
                formControlName="end"
                (dateChange)="endChange($event)"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="picker1"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #picker1></mat-date-range-picker>
          </mat-form-field>
          &nbsp;
          <span style="display: inline-block">
            <mat-form-field [style.width.px]="70">
              <mat-label>Start time</mat-label>
              <input type="time" matInput [(ngModel)]="starttime" />
            </mat-form-field>
            -
            <mat-form-field [style.width.px]="70">
              <mat-label>End time</mat-label>
              <input type="time" matInput [(ngModel)]="endtime" />
            </mat-form-field>
            &nbsp;
            <button
              (click)="valuechange()"
              mat-icon-button
              color="primary"
              aria-label="Example icon button with a menu icon"
            >
              <mat-icon>check_circle</mat-icon>
            </button>
            <button
              (click)="clearValue()"
              mat-icon-button
              color="accent"
              aria-label="Example icon button with a menu icon"
            >
              <mat-icon>clear</mat-icon>
            </button>
          </span>
          <!-- <mat-form-field>
            <input
              matInput
              [matDatepicker]="picker1"
              placeholder="Choose Date"
              [formControl]="date1"
              (dateChange)="startChange()"
            />
            <mat-datepicker-toggle
              matSuffix
              [for]="picker1"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field> -->
        </div>

        <div
          class="col-lg-3"
          *ngIf="select !== ''"
          [hidden]="!dataSource || select == 'W8'"
          style="display: inline; margin-left: 50px; margin-top: 20px"
        >
          <span style="font-size: 25px; font-weight: bold"
            >เช็คยา : {{ checkAllergy.percen2 + "% " }}</span
          >
          <span>{{ checkAllergy.num2 + "/" + checkAllergy.len }}</span>
        </div>
      </div>
      <section
        class="example-container mat-elevation-z8"
        tabindex="0"
        [hidden]="!dataSource"
      >
        <table
          mat-table
          [dataSource]="dataSource"
          #MatSort="matSort"
          matSort
          class="mat-elevation-z8"
          matTableExporter
          #exporter="matTableExporter"
          matSortActive="createdDT"
          matSortDirection="desc"
        >
          <ng-container matColumnDef="patientNO">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              patientNO
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.patientNO }}
            </td>
          </ng-container>

          <ng-container matColumnDef="QN">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              QN
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.QN }}
            </td>
          </ng-container>

          <ng-container matColumnDef="patientName">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              patientName
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.patientName }}
            </td>
          </ng-container>
          <ng-container matColumnDef="createdDT">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              createdDT
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.createdDT }}
            </td>
          </ng-container>
          <ng-container matColumnDef="druglist">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Drugs
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              <div style="display: flex">
                <button
                  button
                  mat-raised-button
                  color="primary"
                  (click)="listDrug(element)"
                  style="margin-left: 20px"
                >
                  รายการยา
                </button>

                <button
                  button
                  mat-raised-button
                  style="background-color: #ffc107; margin-left: 10px"
                  (click)="drugCut(element)"
                  *ngIf="element.status === 'Y'"
                >
                  มียาค้างจ่าย
                </button>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="timestamp">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Status
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              <i
                class="fas fa-check-circle"
                style="font-size: 40px; color: #20ad60"
                *ngIf="element.timestamp && element.check == 'Y'"
              ></i>
              <i
                class="fas fa-times-circle"
                style="font-size: 40px; color: #dc3545"
                *ngIf="!element.timestamp && element.check == 'Y'"
              ></i>
            </td>
          </ng-container>
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </section>
      <div>
        <mat-paginator
          [hidden]="!dataSource"
          style="float: right"
          #MatPaginator="matPaginator"
          [length]="10"
          [pageSize]="10"
          [pageSizeOptions]="[10, 50, 100]"
          showFirstLastButtons
        >
        </mat-paginator>
      </div>
    </div>

    <div
      class="modal fade custom-class"
      id="exampleModal"
      data-backdrop="static"
    >
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <p
              style="font-size: larger; font-weight: bold"
              class="modal-title"
              id="exampleModalLabel"
            >
              รายการยา
            </p>

            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true" (click)="setFocus()">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p
              style="font-size: 14px; font-weight: bold"
              class="modal-title"
              id="exampleModalLabel"
            >
              ชื่อ : {{ dataP ? dataP.patientName : "" }} &nbsp; &nbsp;
              เลชบัตรประชาชน :
              {{ dataP ? dataP.cid : "" }}
            </p>
            <div>
              <div class="row">
                <div [hidden]="dataDrug.length === 0" class="col-8">
                  <span style="font-weight: bold; color: #f40000"
                    >รายการแพ้ยา</span
                  >
                  <div class="table-responsive" style="max-height: 200px">
                    <table class="table table-danger">
                      <thead>
                        <tr>
                          <!-- <th style="padding-right: 50px; border-right: 0px">
                            #
                          </th> -->
                          <!-- <th style="padding-right: 50px; border-right: 0px"></th> -->

                          <th style="padding-right: 50px; border-right: 0px">
                            โรงพยาบาล
                          </th>
                          <th style="padding-right: 50px; border-right: 0px">
                            typedx
                          </th>
                          <th style="padding-right: 50px; border-right: 0px">
                            ระดับแพ้ยา
                          </th>
                          <!-- <th style="padding-right: 50px; border-right: 0px">
                            รหัสยา
                          </th> -->
                          <!-- <th style="padding-right: 50px; border-right: 0px">
                            วันที่
                          </th> -->
                          <th
                            class="sticky-col st-th"
                            style="padding-right: 50px; border-right: 0px"
                          >
                            ชื่อยา
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let i of dataDrug; let x = index">
                          <!-- <td style="border-right: 0px; vertical-align: middle">
                            <div style="width: 10px">{{ x + 1 }}</div>
                          </td> -->

                          <td style="border-right: 0px; vertical-align: middle">
                            {{ i.NAME }}
                          </td>
                          <td
                            style="
                              border-right: 0px;
                              vertical-align: middle;
                              white-space: nowrap;
                            "
                          >
                            {{ i.typedx }}
                          </td>
                          <td
                            style="
                              border-right: 0px;
                              vertical-align: middle;
                              white-space: nowrap;
                            "
                          >
                            {{ i.allerglevelcode }}
                          </td>
                          <!-- <td
                            style="
                              border-right: 0px;
                              vertical-align: middle;
                              white-space: nowrap;
                            "
                          >
                            {{ i.drugcode }}
                          </td> -->

                          <!-- <td
                            style="
                              border-right: 0px;
                              vertical-align: middle;
                              white-space: nowrap;
                            "
                          >
                            {{ i.daterecord }}
                          </td> -->
                          <td
                            class="sticky-col st-td"
                            style="border-right: 0px; vertical-align: middle"
                          >
                            {{ i.drugname }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div [hidden]="dataDrug2.length === 0" class="col-4">
                  <span style="font-weight: bold; color: #f40000">
                    รายการแพ้ยาโรงพยาบาลมหาราชนครราชสีมา
                  </span>
                  <div class="table-responsive" style="max-height: 200px">
                    <table class="table table-danger">
                      <thead>
                        <tr>
                          <!-- <th style="padding-right: 50px; border-right: 0px">
                            #
                          </th> -->
                          <!-- <th style="padding-right: 50px; border-right: 0px"></th> -->
                          <th style="padding-right: 50px; border-right: 0px">
                            ชื่อยา
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let i of dataDrug2; let x = index">
                          <!-- <td style="border-right: 0px; vertical-align: middle">
                            <div style="width: 10px">{{ x + 1 }}</div>
                          </td> -->

                          <td style="border-right: 0px; vertical-align: middle">
                            {{ i.drugName }}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <p style="font-weight: bold" *ngIf="datatime">
                สถานะ :
                <i
                  class="fas fa-check-circle"
                  style="font-size: 15px; color: #20ad60"
                ></i>
              </p>
              <p style="font-weight: bold" *ngIf="!datatime">
                สถานะ :
                <i
                  class="fas fa-times-circle"
                  style="font-size: 15px; color: #dc3545"
                ></i>
              </p>
              <p *ngIf="datatime" style="font-weight: bold">
                ลงชื่อ : {{ namePhar }}
              </p>
              <hr />
            </div>

            <div>
              <p style="font-weight: bold; display: inline">รายการยา</p>
            </div>
            <div style="display: inline">
              <mat-form-field
                class="example-full-width"
                style="margin-right: 5px"
              >
                <mat-label>รายการยา</mat-label>
                <input
                  required
                  #inputadd
                  type="text"
                  matInput
                  [matAutocomplete]="auto6"
                  (input)="filter_add()"
                  (focus)="filter_add()"
                  [(ngModel)]="drugAdd"
                />
                <mat-autocomplete requireSelection #auto6="matAutocomplete">
                  <mat-option
                    *ngFor="let option of dataAdd"
                    [value]="option.code.trim() + '&&' + option.name.trim()"
                  >
                    {{ option.name.trim() }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>

            <button
              [disabled]="!drugAdd"
              button
              mat-raised-button
              color="primary"
              type="button"
              class="butt-sm"
              (click)="addError()"
            >
              <i class="fas fa-plus-circle"></i
              ><span style="margin: 5px">รายงานข้อผิดพลาด</span>
            </button>
            <div
              class="table-responsive"
              style="max-height: 200px"
              [hidden]="!drugPatient"
            >
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>รหัสยา</th>
                    <th>ชื่อยา</th>
                    <th>จำนวน</th>
                    <th>หน่วย</th>
                    <th>ผู้จัด</th>
                    <th>วันที่</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of drugPatient; let i = index">
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ i + 1 }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.drugCode }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.drugName }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.qty }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.unit }}
                    </td>
                    <td
                      style="border-right: 0px; vertical-align: middle"
                      class="text-nowrap"
                    >
                      {{ item.nameCheck ? item.nameCheck : "" }}
                    </td>
                    <td
                      style="border-right: 0px; vertical-align: middle"
                      class="text-nowrap"
                    >
                      {{ item.lastmodified }}
                    </td>
                    <td
                      style="border-right: 0px; vertical-align: middle"
                      class="text-nowrap"
                    >
                      <button
                        button
                        mat-raised-button
                        color="primary"
                        type="button"
                        class="butt-sm"
                        (click)="cutDispend(item)"
                        style="margin-right: 10px"
                      >
                        ตัดจ่ายยา
                      </button>
                      <button
                        button
                        mat-raised-button
                        color="warn"
                        type="button"
                        class="butt-sm"
                        (click)="reportError({ dataP: dataP, item: item })"
                      >
                        รายงานข้อผิดพลาด
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              (click)="confirm()"
              class="btn btn-primary"
              *ngIf="!datatime && checkdrug === 'Y'"
            >
              Confirm
            </button>
            <button
              type="button"
              class="btn btn-danger"
              data-dismiss="modal"
              (click)="setFocus()"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal_owe">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
            <p
              style="font-size: larger; font-weight: bold"
              class="modal-title"
              id="exampleModalLabel"
            >
              รายการยาค้างจ่าย
            </p>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <div class="table-responsive" style="max-height: 500px">
              <table class="table">
                <thead>
                  <tr>
                    <th></th>
                    <th>#</th>
                    <th class="text-nowrap">รหัสยา</th>
                    <th class="text-nowrap">ชื่อยา</th>
                    <th class="text-nowrap">จำนวนจ่ายยา</th>
                    <th class="text-nowrap">จำนวนตัดจ่ายยา</th>
                    <th class="text-nowrap">จำนวนคงเหลือ</th>
                    <th class="text-nowrap">เภสัชกร</th>
                    <th class="text-nowrap">รหัสชั้น</th>
                    <th class="text-nowrap">วันที่</th>
                  </tr>
                </thead>
                <tbody *ngFor="let item of drugcut; let i = index">
                  <tr>
                    <td style="border-right: 0px; vertical-align: middle">
                      <div style="display: flex">
                        <div
                          class="example-button-container"
                          style="margin: 5px; display: flex"
                        >
                          <button
                            matTooltip="ลบข้อมูล"
                            matTooltipPosition="above"
                            style="
                              width: 30px;
                              height: 30px;
                              margin-right: 10px;
                            "
                            mat-mini-fab
                            color="warn"
                            (click)="deleteCutdrug(drugcut[i])"
                          >
                            <i
                              class="fas fa-trash"
                              style="margin-bottom: 15px; margin-left: 1px"
                            ></i>
                          </button>

                          <button
                            [hidden]="!checkprint"
                            matTooltip="re-print"
                            matTooltipPosition="above"
                            style="
                              width: 30px;
                              height: 30px;
                              margin-right: 10px;
                            "
                            mat-mini-fab
                            color="primary"
                            (click)="sendprint(drugcut[i])"
                          >
                            <i
                              class="fas fa-print"
                              style="margin-bottom: 15px; margin-left: 1px"
                            ></i>
                          </button>
                          <button
                            button
                            mat-raised-button
                            color="primary"
                            type="button"
                            class="butt-sm"
                            (click)="dispendDrug(item)"
                          >
                            จ่ายยา
                          </button>
                        </div>
                        <div
                          class="example-button-container"
                          style="margin: 5px"
                        >
                          <button
                            *ngIf="drugcut[i].amount[0]"
                            matTooltip="ดูประวัติ"
                            matTooltipPosition="above"
                            style="width: 30px; height: 30px"
                            data-toggle="collapse"
                            [attr.data-target]="'#demo' + i"
                            mat-mini-fab
                            color="primary"
                            aria-label="Example icon button with a filter list icon"
                          >
                            <i
                              class="fas fa-eye"
                              style="margin-bottom: 15px; margin-left: 1px"
                            ></i>
                          </button>
                        </div>
                      </div>
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ i + 1 }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.drugcode }}
                    </td>
                    <td
                      class="text-nowrap"
                      style="border-right: 0px; vertical-align: middle"
                    >
                      {{ item.drugname }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.realamount }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.cutamount }}
                    </td>
                    <td style="border-right: 0px; vertical-align: middle">
                      {{ item.balanceamount }}
                    </td>
                    <td
                      class="text-nowrap"
                      style="border-right: 0px; vertical-align: middle"
                    >
                      {{ item.phar_name }}
                    </td>
                    <td
                      class="text-nowrap"
                      style="border-right: 0px; vertical-align: middle"
                    >
                      {{ item.departmentcode }}
                    </td>
                    <td
                      class="text-nowrap"
                      style="border-right: 0px; vertical-align: middle"
                    >
                      {{ item.createdDT }}
                    </td>
                  </tr>
                  <tr>
                    <td colspan="10" class="hiddenRow">
                      <div id="demo{{ i }}" class="accordian-body collapse">
                        <table class="table table-primary">
                          <thead>
                            <tr>
                              <th></th>
                              <th>จำนวนจ่ายยา</th>
                              <th>เภสัชกร</th>
                              <th>วันที่</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr
                              *ngFor="
                                let item of drugcut[i].amount;
                                let j = index
                              "
                            >
                              <td width="10px">
                                <div style="display: flex">
                                  <button
                                    matTooltip="ลบข้อมูล"
                                    matTooltipPosition="above"
                                    style="
                                      width: 30px;
                                      height: 30px;
                                      margin-right: 10px;
                                    "
                                    mat-mini-fab
                                    color="warn"
                                    (click)="
                                      deleteCutowe(
                                        drugcut[i].id,
                                        drugcut[i].id2[j],
                                        drugcut[i].amount[j]
                                      )
                                    "
                                  >
                                    <i
                                      class="fas fa-trash"
                                      style="
                                        margin-bottom: 15px;
                                        margin-left: 1px;
                                      "
                                    ></i>
                                  </button>
                                  <!-- <button
                                    matTooltip="re-print"
                                    matTooltipPosition="above"
                                    style="
                                      width: 30px;
                                      height: 30px;
                                      margin-right: 10px;
                                    "
                                    mat-mini-fab
                                    color="primary"
                                    (click)="sendprintChildren(drugcut[i], j)"
                                  >
                                    <i
                                      class="fas fa-print"
                                      style="
                                        margin-bottom: 15px;
                                        margin-left: 1px;
                                      "
                                    ></i>
                                  </button> -->
                                </div>
                              </td>
                              <td style="vertical-align: middle">{{ item }}</td>
                              <td style="vertical-align: middle">
                                {{ drugcut[i].phar2_name[j] }}
                              </td>
                              <td style="vertical-align: middle">
                                {{ drugcut[i].datetime[j] }}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Modal footer -->
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </mat-tab>

  <mat-tab label="รายงานยืนยันแพ้ยา">
    <div class="container-fluid pt-2">
      <div class="row">
        <div class="col-lg-9">
          <mat-form-field class="example-form-field" style="float: left">
            <mat-label>เลือกวันที่</mat-label>
            <mat-date-range-input
              [formGroup]="campaignOne"
              [rangePicker]="campaignOnePickerr"
              [comparisonStart]="campaignOne.value.start"
              [comparisonEnd]="campaignOne.value.end"
            >
              <input
                matStartDate
                placeholder="วันที่เริ่มต้น"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="วันที่สิ้นสุด"
                formControlName="end"
                (dateChange)="endChange($event)"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="campaignOnePickerr"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #campaignOnePickerr></mat-date-range-picker>
          </mat-form-field>
          <span style="display: inline-block">
            <mat-form-field [style.width.px]="70">
              <mat-label>Start time</mat-label>
              <input type="time" matInput [(ngModel)]="starttime" />
            </mat-form-field>
            -
            <mat-form-field [style.width.px]="70">
              <mat-label>End time</mat-label>
              <input type="time" matInput [(ngModel)]="endtime" />
            </mat-form-field>
            &nbsp;
            <button
              (click)="valuechange()"
              mat-icon-button
              color="primary"
              aria-label="Example icon button with a menu icon"
            >
              <mat-icon>check_circle</mat-icon>
            </button>
            <button
              (click)="clearValue()"
              mat-icon-button
              color="accent"
              aria-label="Example icon button with a menu icon"
            >
              <mat-icon>clear</mat-icon>
            </button>
          </span>
        </div>

        <div class="col-lg-3">
          <mat-form-field class="example-full-width" style="float: right">
            <input matInput (keyup)="applyFilter2($event)" #input3 />
            <mat-placeholder>Search</mat-placeholder>
            <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
          </mat-form-field>
        </div>
      </div>
      <section
        class="example-container mat-elevation-z8"
        tabindex="0"
        [hidden]="!dataSource3"
      >
        <table
          mat-table
          [dataSource]="dataSource3"
          #MatSort3="matSort"
          matSort
          class="mat-elevation-z8"
          matTableExporter
          #exporter3="matTableExporter"
          matSortActive="timestamp"
          matSortDirection="desc"
          [hiddenColumns]="[]"
        >
          <ng-container matColumnDef="user">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Pharmacist ID
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.user }}
            </td>
          </ng-container>
          <ng-container matColumnDef="name">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Pharmacist Name
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="site">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Site
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.site }}
            </td>
          </ng-container>
          <ng-container matColumnDef="queue">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Queue
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.queue == "null" ? "" : element.queue }}
            </td>
          </ng-container>
          <ng-container matColumnDef="hn">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              HN
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.hn }}
            </td>
          </ng-container>
          <ng-container matColumnDef="patientName">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Patient Name
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.patientName }}
            </td>
          </ng-container>
          <ng-container matColumnDef="timestamp">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Date
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.timestamp }}
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns3; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns3"></tr>
        </table>
      </section>
      <div [hidden]="!dataSource3">
        <button
          mat-raised-button
          color="primary"
          (click)="
            exporter3.exportTable('xlsx', {
              fileName: nameExcel3,
              sheet: 'sheet_name',
              Props: { Author: 'Talha' }
            })
          "
        >
          Export Excel
        </button>
        <mat-paginator
          style="float: right"
          #MatPaginator3="matPaginator"
          [length]="10"
          [pageSize]="10"
          [pageSizeOptions]="[10, 50, 100]"
          showFirstLastButtons
        >
        </mat-paginator>
      </div>
    </div>
  </mat-tab>
  <mat-tab label="รายงานตัดจ่ายยา">
    <div class="container-fluid pt-2">
      <div class="row">
        <div class="col-lg-5">
          <mat-form-field class="example-form-field" style="float: left">
            <mat-label>เลือกวันที่</mat-label>
            <mat-date-range-input
              [formGroup]="campaignOne"
              [rangePicker]="campaignOnePicker"
              [comparisonStart]="campaignOne.value.start"
              [comparisonEnd]="campaignOne.value.end"
            >
              <input
                matStartDate
                placeholder="วันที่เริ่มต้น"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="วันที่สิ้นสุด"
                formControlName="end"
                (dateChange)="endChange($event)"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="campaignOnePicker"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #campaignOnePicker></mat-date-range-picker>
          </mat-form-field>
        </div>
        <div class="col-lg-4">
          <mat-form-field>
            <mat-label>Select Site</mat-label>
            <mat-select
              [(ngModel)]="select"
              (ngModelChange)="changeFloorReport()"
            >
              <mat-option value="">All</mat-option>
              <mat-option value="W9">ห้องยาชั้น 1</mat-option>
              <mat-option value="W8">ห้องยาชั้น 2</mat-option>
              <mat-option value="W18">ห้องยาชั้น 3</mat-option>
              <mat-option value="W19">ห้องยา M - Park</mat-option>
              <mat-option value="W20">ห้องยา ER OPD</mat-option>
              <mat-option value="W21">ห้องยา ER IPD</mat-option>
              <mat-option value="W13">ห้องยา ตึกมะเร็ง</mat-option>
              <mat-option value="W11">ห้องยา รพ.หัวทะเล</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-lg-3">
          <mat-form-field class="example-full-width" style="float: right">
            <input matInput (keyup)="applyFilter($event)" #input2 />
            <mat-placeholder>Search</mat-placeholder>
            <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
          </mat-form-field>
        </div>
      </div>
      <span></span>
      <section
        class="example-container mat-elevation-z8"
        tabindex="0"
        [hidden]="!dataSource2"
      >
        <table
          mat-table
          [dataSource]="dataSource2"
          #MatSort2="matSort"
          matSort
          class="mat-elevation-z8"
          matTableExporter
          #exporter2="matTableExporter"
          matSortActive="createdDT"
          matSortDirection="desc"
          [hiddenColumns]=""
        >
          <ng-container matColumnDef="hn">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              HN
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.hn }}
            </td>
          </ng-container>

          <ng-container matColumnDef="patientName">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              patient Name
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.patientName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="checker_name">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Pharmacist
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.checker_name }}
            </td>
          </ng-container>
          <ng-container matColumnDef="floor">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Floor
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.floor }}
            </td>
          </ng-container>
          <ng-container matColumnDef="drugcode">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Drug Code
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.drugcode }}
            </td>
          </ng-container>
          <ng-container matColumnDef="drugname">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Drug Name
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.drugname }}
            </td>
          </ng-container>
          <ng-container matColumnDef="realamount">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Amount
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.realamount }}
            </td>
          </ng-container>
          <ng-container matColumnDef="cutamount">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Cut Amount
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.cutamount }}
            </td>
          </ng-container>
          <ng-container matColumnDef="balanceamount">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Balance
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.balanceamount }}
            </td>
          </ng-container>
          <ng-container matColumnDef="createdDT">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Date
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.createdDT }}
            </td>
          </ng-container>
          <ng-container matColumnDef="relativePhone">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Phone
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.relativePhone }}
            </td>
          </ng-container>
          <ng-container matColumnDef="relativeAddress">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Address
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.relativeAddress }}
            </td>
          </ng-container>
          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Status
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="
                padding-left: 20px;
                padding-right: 20px;
                white-space: nowrap;
              "
            >
              <!-- <i
                [ngClass]="
                  element.status == 'N'
                    ? 'fas fa-check-circle'
                    : 'fas fa-times-circle'
                "
                [ngStyle]="
                  element.status == 'N'
                    ? { 'font-size': '40px', color: '#20ad60' }
                    : { 'font-size': '40px', color: '#dc3545' }
                "
              ></i> -->

              {{ element.status == "N" ? "จ่ายยาแล้ว" : "ค้างจ่ายยา" }}
            </td>
          </ng-container>
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns2; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns2"></tr>
        </table>
      </section>
      <div [hidden]="!dataSource2">
        <button
          mat-raised-button
          color="primary"
          (click)="
            exporter2.exportTable('xlsx', {
              fileName: nameExcel2,
              sheet: 'sheet_name',
              Props: { Author: 'Talha' }
            })
          "
        >
          Export Excel
        </button>
        <mat-paginator
          style="float: right"
          #MatPaginator2="matPaginator"
          [length]="10"
          [pageSize]="10"
          [pageSizeOptions]="[10, 50, 100]"
          showFirstLastButtons
        >
        </mat-paginator>
      </div>
    </div>
  </mat-tab>
  <mat-tab label="รายงานจ่ายยาตัดจ่ายยา">
    <div class="container-fluid pt-2">
      <div class="row">
        <div class="col-lg-5">
          <mat-form-field class="example-form-field" style="float: left">
            <mat-label>เลือกวันที่</mat-label>
            <mat-date-range-input
              [formGroup]="campaignOne"
              [rangePicker]="campaignOnePicker2"
              [comparisonStart]="campaignOne.value.start"
              [comparisonEnd]="campaignOne.value.end"
            >
              <input
                matStartDate
                placeholder="วันที่เริ่มต้น"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="วันที่สิ้นสุด"
                formControlName="end"
                (dateChange)="endChange($event)"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="campaignOnePicker2"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #campaignOnePicker2></mat-date-range-picker>
          </mat-form-field>
        </div>
        <div class="col-lg-4">
          <mat-form-field>
            <mat-label>Select Site</mat-label>
            <mat-select
              [(ngModel)]="select"
              (ngModelChange)="changeFloorReport()"
            >
              <mat-option value="">All</mat-option>
              <mat-option value="W9">ห้องยาชั้น 1</mat-option>
              <mat-option value="W8">ห้องยาชั้น 2</mat-option>
              <mat-option value="W18">ห้องยาชั้น 3</mat-option>
              <mat-option value="W19">ห้องยา M - Park</mat-option>
              <mat-option value="W20">ห้องยา ER OPD</mat-option>
              <mat-option value="W21">ห้องยา ER IPD</mat-option>
              <mat-option value="W13">ห้องยา ตึกมะเร็ง</mat-option>
              <mat-option value="W11">ห้องยา รพ.หัวทะเล</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-lg-3">
          <mat-form-field class="example-full-width" style="float: right">
            <input matInput (keyup)="applyFilter4($event)" #input4 />
            <mat-placeholder>Search</mat-placeholder>
            <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
          </mat-form-field>
        </div>
      </div>
      <section
        class="example-container mat-elevation-z8"
        tabindex="0"
        [hidden]="!dataSource4"
      >
        <table
          mat-table
          [dataSource]="dataSource4"
          #MatSort4="matSort"
          matSort
          class="mat-elevation-z8"
          matTableExporter
          #exporter4="matTableExporter"
          matSortActive="createdDT"
          matSortDirection="desc"
          [hiddenColumns]=""
        >
          <ng-container matColumnDef="pharmacist">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Pharmacist
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.pharmacist }}
            </td>
          </ng-container>

          <ng-container matColumnDef="departmentcode">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Departmentcode
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.departmentcode }}
            </td>
          </ng-container>

          <ng-container matColumnDef="drugname">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Drugname
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.drugname }}
            </td>
          </ng-container>

          <ng-container matColumnDef="amount">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Amount
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.amount }}
            </td>
          </ng-container>

          <ng-container matColumnDef="createDT">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              createDT
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.createDT }}
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns4; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns4"></tr>
        </table>
      </section>
      <div [hidden]="!dataSource4">
        <button
          mat-raised-button
          color="primary"
          (click)="
            exporter4.exportTable('xlsx', {
              fileName: nameExcel4,
              sheet: 'sheet_name',
              Props: { Author: 'Talha' }
            })
          "
        >
          Export Excel
        </button>
        <mat-paginator
          style="float: right"
          #MatPaginator4="matPaginator"
          [length]="10"
          [pageSize]="10"
          [pageSizeOptions]="[10, 50, 100]"
          showFirstLastButtons
        >
        </mat-paginator>
      </div></div
  ></mat-tab>
  <mat-tab label="รายงาน Med Error">
    <div class="container-fluid pt-2">
      <div class="row">
        <div class="col-lg-7 d-flex">
          <mat-form-field class="example-form-field" style="float: left">
            <mat-label>เลือกวันที่</mat-label>
            <mat-date-range-input
              [formGroup]="campaignOne"
              [rangePicker]="campaignOnePicker3"
              [comparisonStart]="campaignOne.value.start"
              [comparisonEnd]="campaignOne.value.end"
            >
              <input
                matStartDate
                placeholder="วันที่เริ่มต้น"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="วันที่สิ้นสุด"
                formControlName="end"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="campaignOnePicker3"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #campaignOnePicker3></mat-date-range-picker>
          </mat-form-field>
          &nbsp;
          <span style="display: inline-block">
            <mat-form-field [style.width.px]="70">
              <mat-label>Start time</mat-label>
              <input type="time" matInput [(ngModel)]="starttime" />
            </mat-form-field>
            -
            <mat-form-field [style.width.px]="70">
              <mat-label>End time</mat-label>
              <input type="time" matInput [(ngModel)]="endtime" />
            </mat-form-field>
            &nbsp;
            <button
              (click)="valuechange()"
              mat-icon-button
              color="primary"
              aria-label="Example icon button with a menu icon"
            >
              <mat-icon>check_circle</mat-icon>
            </button>
            <button
              (click)="clearValue()"
              mat-icon-button
              color="accent"
              aria-label="Example icon button with a menu icon"
            >
              <mat-icon>clear</mat-icon>
            </button>
          </span>
          <!-- <span
            *ngIf="choicecheckmed != '1'"
            style="
              font-size: 18px;
              font-weight: bold;
              margin: 20px 10px 13px 20px;
            "
            >เวลาเฉลี่ย : {{ avgTime }}</span
          > -->
          <!-- <div class="col-lg-4"> -->
          <mat-form-field>
            <mat-label>Select Site</mat-label>
            <mat-select [(ngModel)]="select" (ngModelChange)="filter_type()">
              <mat-option value="">All</mat-option>
              <mat-option value="W9">ห้องยาชั้น 1</mat-option>
              <mat-option value="W8">ห้องยาชั้น 2</mat-option>
              <mat-option value="W18">ห้องยาชั้น 3</mat-option>
              <mat-option value="W19">ห้องยา M - Park</mat-option>
              <mat-option value="W20">ห้องยา ER OPD</mat-option>
              <mat-option value="W21">ห้องยา ER IPD</mat-option>
              <mat-option value="W13">ห้องยา ตึกมะเร็ง</mat-option>
              <mat-option value="W11">ห้องยา รพ.หัวทะเล</mat-option>
            </mat-select>
          </mat-form-field>
          <!-- </div> -->
        </div>
        <div class="col-lg-2">
          <!-- <mat-form-field>
            <mat-label>เลือกรายงาน</mat-label>
            <mat-select
              [(ngModel)]="choicecheckmed"
              (ngModelChange)="reportCheckmed()"
            >
              <mat-option value="1">รายงาน MED-Error</mat-option>
              <mat-option value="2">รายงานเวลาเช็คยา</mat-option>
            </mat-select>
          </mat-form-field> -->
          <mat-form-field>
            <mat-label>เลือกตำหน่งที่ผิด</mat-label>
            <mat-select
              [(ngModel)]="filterType"
              (ngModelChange)="filter_type()"
            >
              <mat-option selected value="">All</mat-option>
              <mat-option value="pe">pe</mat-option>
              <mat-option value="de">de</mat-option>
              <mat-option value="predis">predis</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-lg-3">
          <mat-form-field class="example-full-width" style="float: right">
            <input matInput (keyup)="applyFilter5($event)" #input5 />
            <mat-placeholder>Search</mat-placeholder>
            <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
          </mat-form-field>
        </div>
      </div>
      <div style="margin-bottom: 10px">
        <span style="font-size: 20px; font-weight: bolder">
          &nbsp;&nbsp; Error ทั้งหมด :
          {{ numError ? numError.all : "" }}&nbsp;&nbsp;&nbsp;&nbsp; PE :
          {{ numError ? numError.pe : "" }}&nbsp;&nbsp;&nbsp;&nbsp; DE :
          {{ numError ? numError.de : "" }}&nbsp;&nbsp;&nbsp;&nbsp; PREDIS :
          {{ numError ? numError.predis : "" }}&nbsp;(Key :{{
            numError ? numError.key : ""
          }}
          จัด :{{ numError ? numError.set : "" }} Check :{{
            numError ? numError.check : ""
          }}
          อื่นๆ :{{ numError ? numError.etc : "" }})
        </span>
      </div>
      <section
        class="example-container mat-elevation-z8"
        tabindex="0"
        [hidden]="!dataSource5"
      >
        <table
          mat-table
          [dataSource]="dataSource5"
          #MatSort5="matSort"
          matSort
          matSortActive="createDT"
          matSortDirection="desc"
          class="mat-elevation-z8"
          matTableExporter
          #exporter5="matTableExporter"
        >
          <ng-container matColumnDef="hn">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              รหัสคนไข้
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.hn }}
            </td>
          </ng-container>

          <ng-container
            [matColumnDef]="choicecheckmed == '1' ? 'location' : 'queue'"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              {{ choicecheckmed == "1" ? "ห้องยา" : "คิว" }}
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ choicecheckmed == "1" ? element.location : element.queue }}
            </td>
          </ng-container>

          <ng-container
            [matColumnDef]="
              choicecheckmed == '1' ? 'position_text' : 'timestamp'
            "
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              {{ choicecheckmed == "1" ? "ตำแหน่งที่ผิด" : "เวลาเช็คยา" }}
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{
                choicecheckmed == "1"
                  ? element.position_text
                  : element.timestamp
              }}
            </td>
          </ng-container>
          <ng-container
            [matColumnDef]="
              choicecheckmed == '1' ? 'type_text' : 'checkComplete'
            "
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              {{
                choicecheckmed == "1" ? "รูปแบบความผิดพลาด" : "เวลาเช็คยาเสร็จ"
              }}
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{
                choicecheckmed == "1"
                  ? element.type_text
                  : element.checkComplete
              }}
            </td>
          </ng-container>
          <ng-container
            [matColumnDef]="choicecheckmed == '1' ? 'med_wrong_name' : 'time'"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              {{ choicecheckmed == "1" ? "ชื่อยาผิด" : "เวลา" }}
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{
                choicecheckmed == "1" ? element.med_wrong_name : element.time
              }}
            </td>
          </ng-container>
          <ng-container matColumnDef="med_wrong_text">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              รายละเอียดผิด
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.med_wrong_text }}
            </td>
          </ng-container>
          <ng-container
            matColumnDef="med_good_name"
            *ngIf="choicecheckmed == '1'"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              ชื่อยาถูก
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.med_good_name }}
            </td>
          </ng-container>
          <ng-container
            matColumnDef="med_good_text"
            *ngIf="choicecheckmed == '1'"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              รายละเอียดถูก
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.med_good_text }}
            </td>
          </ng-container>
          <ng-container
            matColumnDef="interceptor_name"
            *ngIf="choicecheckmed == '1'"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              ผู้ดักจับ
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.interceptor_name }}
            </td>
          </ng-container>
          <ng-container
            matColumnDef="offender_name"
            *ngIf="choicecheckmed == '1'"
          >
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              ผู้ก่อความคลาดเคลื่อน
            </th>
            <td
              class="text-nowrap"
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.offender_name }}
            </td>
          </ng-container>

          <ng-container matColumnDef="level" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Level
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.level }}
            </td>
          </ng-container>

          <ng-container matColumnDef="occurrence" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              เวลาเกิดเหตุ
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.occurrence }}
            </td>
          </ng-container>
          <ng-container matColumnDef="source" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              แหล่งที่มา
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.source }}
            </td>
          </ng-container>
          <ng-container matColumnDef="error_type" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Error Type
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.error_type }}
            </td>
          </ng-container>
          <ng-container matColumnDef="site" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              PCT / ห้องตรวจ
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.site }}
            </td>
          </ng-container>
          <ng-container matColumnDef="type_pre" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              ชนิดใบสั่งยา
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.type_pre }}
            </td>
          </ng-container>
          <ng-container matColumnDef="note" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              หมายเหตุ
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.note }}
            </td>
          </ng-container>
          <ng-container matColumnDef="cause" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              สาเหตุ
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.cause }}
            </td>
          </ng-container>
          <ng-container matColumnDef="hnDT" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              เวลาลงข้อมูลคนไข้
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.hnDT }}
            </td>
          </ng-container>
          <ng-container matColumnDef="createDT" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              เวลาลงข้อมูล Error
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.createDT }}
            </td>
          </ng-container>
          <ng-container matColumnDef="Action" *ngIf="choicecheckmed == '1'">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              Action
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 5px; padding-right: 5px"
            >
              <span
                style="display: flex"
                *ngIf="
                  dataUser.user === 'admin' ||
                  dataUser.user.toLowerCase() === 'p07' ||
                  dataUser.user.toLowerCase() === 'p54' ||
                  dataUser.user.toLowerCase() === 'test' ||
                  dataUser.user.toLowerCase() === 'p22'
                "
              >
                <!-- <button
                  style="margin: 5px"
                  mat-flat-button
                  color="primary"
                  (click)="manageErrormed(element, 'edit')"
                >
                  แก้ไข
                </button> -->
                <button
                  type="button"
                  style="margin: 5px"
                  class="btn btn-warning btn-sm"
                  (click)="manageErrormed(element, 'edit')"
                >
                  แก้ไข
                </button>
                <button
                  style="margin: 5px"
                  type="button"
                  class="btn btn-danger btn-sm"
                  (click)="manageErrormed(element, 'delete')"
                >
                  ลบ
                </button>
                <!-- <button
                  style="margin: 5px"
                  mat-flat-button
                  color="warn"
                  (click)="manageErrormed(element, 'delete')"
                >
                  ลบ
                </button> -->
              </span>
              <button
                *ngIf="
                  (dataUser.user === 'admin' ||
                    dataUser.user.toLowerCase() === 'p07' ||
                    dataUser.user.toLowerCase() === 'p54' ||
                    dataUser.user.toLowerCase() === 'test' ||
                    dataUser.user.toLowerCase() === 'p22') &&
                  element.position_text === 'PE'
                "
                style="margin: 0 0 0 40px"
                matTooltip="re-print"
                matTooltipPosition="above"
                type="button"
                class="btn btn-primary btn-sm"
                (click)="rePrint(element)"
              >
                <i class="fas fa-print"></i>
              </button>
              <button
                *ngIf="
                  dataUser.user !== 'admin' &&
                  dataUser.user.toLowerCase() !== 'p07' &&
                  dataUser.user.toLowerCase() !== 'p54' &&
                  dataUser.user.toLowerCase() !== 'test' &&
                  dataUser.user.toLowerCase() !== 'p22' &&
                  element.position_text === 'PE'
                "
                style="margin: 0 0 0 20px"
                matTooltip="re-print"
                matTooltipPosition="above"
                type="button"
                class="btn btn-primary btn-sm"
                (click)="rePrint(element)"
              >
                <i class="fas fa-print"></i>
              </button>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns5; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns5"></tr>
        </table>
      </section>
      <div [hidden]="!dataSource5">
        <button
          mat-raised-button
          color="primary"
          (click)="
            exporter5.exportTable('xlsx', {
              fileName: nameExcel5,
              sheet: 'sheet_name',
              Props: { Author: 'Talha' }
            })
          "
        >
          Export Excel
        </button>
        <mat-paginator
          style="float: right"
          #MatPaginator5="matPaginator"
          [length]="10"
          [pageSize]="10"
          [pageSizeOptions]="[10, 50, 100]"
          showFirstLastButtons
        >
        </mat-paginator>
      </div></div
  ></mat-tab>
  <mat-tab label="เวลาในการจัดยา">
    <div class="container-fluid pt-2">
      <div class="row">
        <div class="col-lg-3">
          <mat-form-field class="example-form-field" style="float: left">
            <mat-label>เลือกวันที่</mat-label>
            <mat-date-range-input
              [formGroup]="campaignOne"
              [rangePicker]="campaignOnePicker6"
              [comparisonStart]="campaignOne.value.start"
              [comparisonEnd]="campaignOne.value.end"
            >
              <input
                matStartDate
                placeholder="วันที่เริ่มต้น"
                formControlName="start"
              />
              <input
                matEndDate
                placeholder="วันที่สิ้นสุด"
                formControlName="end"
                (dateChange)="endChange($event)"
              />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matSuffix
              [for]="campaignOnePicker6"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #campaignOnePicker6></mat-date-range-picker>
          </mat-form-field>
        </div>
        <div class="col-lg-2">
          <mat-form-field>
            <mat-label>Select Site</mat-label>
            <mat-select
              [(ngModel)]="select"
              (ngModelChange)="changeFloorReport()"
            >
              <mat-option value="W9">ห้องยาชั้น 1</mat-option>
              <mat-option value="W8">ห้องยาชั้น 2</mat-option>
              <mat-option value="W18">ห้องยาชั้น 3</mat-option>
              <mat-option value="W19">ห้องยา M - Park</mat-option>
              <mat-option value="W20">ห้องยา ER OPD</mat-option>
              <mat-option value="W21">ห้องยา ER IPD</mat-option>
              <mat-option value="W13">ห้องยา ตึกมะเร็ง</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-lg-4" style="margin-top: 20px">
          <div style="font-size: 25px; font-weight: bold">
            {{ "เวลาเฉลี่ย : " + timeavg }}
          </div>

          <!-- <mat-form-field>
            <mat-label>Select Site</mat-label>
            <mat-select
              [(ngModel)]="select"
              (ngModelChange)="changeFloorReport()"
            >
              <mat-option value="">All</mat-option>
              <mat-option value="W9">ห้องยาชั้น 1</mat-option>
              <mat-option value="W8">ห้องยาชั้น 2</mat-option>
              <mat-option value="W18">ห้องยาชั้น 3</mat-option>
              <mat-option value="W19">ห้องยา M - Park</mat-option>
              <mat-option value="W20">ห้องยา ER OPD</mat-option>
                    <mat-option value="W21">ห้องยา ER IPD</mat-option>
              <mat-option value="W13">ห้องยา ตึกมะเร็ง</mat-option>
<mat-option value="W11">ห้องยา รพ.หัวทะเล</mat-option>
            </mat-select>
          </mat-form-field> -->
        </div>
        <div class="col-lg-3">
          <mat-form-field class="example-full-width" style="float: right">
            <input matInput (keyup)="applyFilter6($event)" #input6 />
            <mat-placeholder>Search</mat-placeholder>
            <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
          </mat-form-field>
        </div>
      </div>
      <section
        class="example-container mat-elevation-z8"
        tabindex="0"
        [hidden]="!dataSource6"
      >
        <table
          mat-table
          [dataSource]="dataSource6"
          #MatSort6="matSort"
          matSort
          class="mat-elevation-z8"
          matTableExporter
          #exporter6="matTableExporter"
          [hiddenColumns]=""
        >
          <ng-container matColumnDef="hn">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              hn
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.hn }}
            </td>
          </ng-container>

          <ng-container matColumnDef="patientname">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              patientname
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.patientname }}
            </td>
          </ng-container>

          <ng-container matColumnDef="starttime">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              starttime
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.starttime }}
            </td>
          </ng-container>

          <ng-container matColumnDef="endtime">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              endtime
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.endtime }}
            </td>
          </ng-container>

          <ng-container matColumnDef="time">
            <th
              mat-header-cell
              *matHeaderCellDef
              mat-sort-header
              style="padding-left: 10px"
            >
              time
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              style="padding-left: 20px; padding-right: 20px"
            >
              {{ element.time }}
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns6; sticky: true"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns6"></tr>
        </table>
      </section>
      <div [hidden]="!dataSource6">
        <button
          mat-raised-button
          color="primary"
          (click)="
            exporter6.exportTable('xlsx', {
              fileName: nameExcel6,
              sheet: 'sheet_name',
              Props: { Author: 'Talha' }
            })
          "
        >
          Export Excel
        </button>
        <mat-paginator
          style="float: right"
          #MatPaginator6="matPaginator"
          [length]="10"
          [pageSize]="10"
          [pageSizeOptions]="[10, 50, 100]"
          showFirstLastButtons
        >
        </mat-paginator>
      </div></div
  ></mat-tab>
</mat-tab-group>

<div class="modal fade" id="check_error" data-backdrop="static">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Med Error</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form
        [formGroup]="medError"
        (ngSubmit)="
          medError.valid ? submitInput($event.submitter.innerText) : ''
        "
      >
        <div class="modal-body">
          <div class="row">
            <div class="col">
              <mat-form-field>
                <mat-label>ตำแหน่งที่ผิด</mat-label>
                <mat-select
                  formControlName="position"
                  (selectionChange)="getDataposition()"
                  required
                >
                  <mat-option *ngFor="let item of positionE" [value]="item">
                    {{ item === "other" ? "อื่นๆ (โปรดระบุ)" : item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field
                class="example-full-width"
                *ngIf="setText.textposition"
              >
                <input
                  required
                  matInput
                  placeholder="ระบุข้อความ"
                  formControlName="position_text"
                />
              </mat-form-field>
            </div>
            <div class="col">
              <mat-form-field>
                <mat-label>รูปแบบความผิดพลาด</mat-label>
                <mat-select
                  [required]="medError.value.position !== 'PE'"
                  formControlName="type"
                  (selectionChange)="getDatatype()"
                >
                  <mat-option
                    *ngFor="let item of gettypeE"
                    [value]="item.id_type"
                  >
                    {{
                      item.name_type === "other"
                        ? "อื่นๆ (โปรดระบุ)"
                        : item.name_type
                    }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field
                class="example-full-width"
                *ngIf="setText.texttype"
              >
                <input
                  required
                  matInput
                  placeholder="ระบุข้อความ"
                  formControlName="type_text"
                />
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div
              class="col"
              *ngIf="
                medError.value.type == 'pe7' ||
                medError.value.type == 'pe8' ||
                medError.value.type == 'pe9'
              "
            >
              <mat-form-field class="example-full-width">
                <mat-label>ชื่อยาที่แพ้</mat-label>
                <input
                  required
                  [required]="
                    medError.value.type !== 'pe7' ||
                    medError.value.type !== 'pe8' ||
                    medError.value.type !== 'pe9'
                  "
                  #inputallergic
                  type="text"
                  matInput
                  formControlName="medcode_err"
                  [matAutocomplete]="auto5"
                  (input)="filter_allergic()"
                  (focus)="filter_allergic()"
                />
                <mat-autocomplete requireSelection #auto5="matAutocomplete">
                  <mat-option
                    *ngFor="let option of dataAllergic"
                    [value]="option.name.trim()"
                  >
                    {{ option.name.trim() }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <mat-form-field class="example-full-width">
                <mat-label>ชื่อยาผิด</mat-label>
                <input
                  required
                  #inputwrong
                  type="text"
                  matInput
                  formControlName="medWrong"
                  [matAutocomplete]="auto2"
                  (input)="filter_wrong()"
                  (focus)="filter_wrong()"
                />
                <mat-autocomplete requireSelection #auto2="matAutocomplete">
                  <mat-option
                    *ngFor="let option of dataWrong"
                    [value]="option.name.trim()"
                  >
                    {{ option.name.trim() }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="col">
              <mat-form-field class="example-full-width">
                <input
                  matInput
                  placeholder="รายละเอียดผิด"
                  formControlName="medWrong_text"
                />
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <mat-form-field class="example-full-width">
                <mat-label>ชื่อยาถูก</mat-label>
                <input
                  required
                  #inputgood
                  type="text"
                  matInput
                  formControlName="medGood"
                  [matAutocomplete]="auto"
                  (input)="filter_good()"
                  (focus)="filter_good()"
                />
                <mat-autocomplete requireSelection #auto="matAutocomplete">
                  <mat-option
                    *ngFor="let option of dataGood"
                    [value]="option.name.trim()"
                  >
                    {{ option.name.trim() }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="col">
              <mat-form-field class="example-full-width">
                <input
                  matInput
                  placeholder="รายละเอียดถูก"
                  formControlName="medGood_text"
                />
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <mat-form-field class="example-full-width">
                <mat-label>ผู้ดักจับ</mat-label>
                <input
                  required
                  #inputinterceptor
                  type="text"
                  matInput
                  formControlName="interceptor"
                  [matAutocomplete]="auto3"
                  (input)="filter_interceptor()"
                  (focus)="filter_interceptor()"
                />
                <mat-autocomplete requireSelection #auto3="matAutocomplete">
                  <mat-option
                    *ngFor="let option of dataInterceptor"
                    [value]="option.userName"
                  >
                    {{ option.userName }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="col">
              <mat-form-field class="example-full-width">
                <mat-label>ผู้ก่อความคลาดเคลื่อน</mat-label>
                <input
                  [required]="medError.value.position !== 'PE'"
                  #inputoffender
                  type="text"
                  matInput
                  formControlName="offender"
                  [matAutocomplete]="auto4"
                  (input)="filter_offender()"
                  (focus)="filter_offender()"
                />

                <mat-autocomplete requireSelection #auto4="matAutocomplete">
                  <mat-option
                    *ngFor="let option of dataOffender"
                    [value]="option.userName"
                  >
                    {{ option.userName }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div
            class="row"
            *ngIf="
              medError.value.position == 'PE' || medError.value.position == 'DE'
            "
          >
            <div class="col-2">
              <mat-form-field style="width: 100%">
                <mat-label>Level</mat-label>
                <mat-select formControlName="level">
                  <mat-option *ngFor="let item of pe_de.level" [value]="item">
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-2">
              <mat-form-field style="width: 100%">
                <mat-label>แหล่งที่มา</mat-label>
                <mat-select formControlName="occurrence">
                  <mat-option
                    *ngFor="let item of pe_de.occurrence"
                    [value]="item"
                  >
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-2">
              <mat-form-field style="width: 100%">
                <mat-label>เวลาเกิดเหตุ</mat-label
                ><mat-select formControlName="source">
                  <mat-option *ngFor="let item of pe_de.source" [value]="item">
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-2">
              <mat-form-field style="width: 100%">
                <mat-label>Error Type</mat-label>
                <mat-select formControlName="error_type">
                  <mat-option
                    *ngFor="let item of pe_de.error_type"
                    [value]="item"
                  >
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-2">
              <mat-form-field style="width: 100%">
                <mat-label>PCT / ห้องตรวจ</mat-label>
                <mat-select formControlName="site">
                  <mat-option *ngFor="let item of pe_de.site" [value]="item">
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-2">
              <mat-form-field style="width: 100%">
                <mat-label>ชนิดใบสั่ง</mat-label>
                <mat-select formControlName="type_pre">
                  <mat-option
                    *ngFor="let item of pe_de.type_pre"
                    [value]="item"
                  >
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <mat-form-field class="example-full-width">
                <mat-label>เลือกข้อความหมายเหตุ</mat-label>
                <mat-select
                  (selectionChange)="changeText($event); note_change.value = ''"
                  #note_change
                >
                  <mat-option *ngFor="let item of pe_de.note" [value]="item">
                    {{ item }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field class="example-full-width">
                <mat-label>หมายเหตุ</mat-label>

                <textarea matInput formControlName="note"></textarea>
              </mat-form-field>
            </div>
          </div>

          <hr *ngIf="checkpre && checkprint" />

          <div *ngIf="checkpre && checkprint" style="text-align: center">
            <iframe id="iframeContainer" style="height: 320px"></iframe>
          </div>
        </div>
        <div class="modal-footer">
          <button
            *ngIf="medError.value.position == 'PE' && checkprint"
            type="submit"
            class="btn btn-info"
          >
            Preview
          </button>
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
