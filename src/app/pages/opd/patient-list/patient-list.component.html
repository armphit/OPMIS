<div style="overflow: auto;margin: 10px;">

  <div class="row">
    <div class="col-lg-9">

      <button type="button" class="btn btn-outline-secondary" style="margin-top: 5px;margin-left: 5px"
        (click)="getData();"><i class="fas fa-sync-alt"></i>&nbsp; Refresh</button>
    </div>
    <div class="col-lg-3">

      <mat-form-field class="example-full-width" style="float: right;">
        <input matInput #swiper (keyup)="applyFilter($event)">
        <mat-placeholder>ค้นหา</mat-placeholder>
        <mat-icon matSuffix style="font-size: 1.2em">search</mat-icon>
      </mat-form-field>

    </div>
  </div>



  <div class="responsive-table">

    <table mat-table [dataSource]="dataSource" #MatSort="matSort" matSort class="mat-elevation-z8" matTableExporter
      #exporter="matTableExporter" matSortActive="readdatetime" matSortDirection="desc">






      <ng-container matColumnDef="hn">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="padding-left: 10px;"> HN </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;"> {{element.hn}} </td>
      </ng-container>

      <ng-container matColumnDef="patientname">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="padding-left: 10px;"> Name </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;"> {{element.patientname}}
        </td>
      </ng-container>

      <ng-container matColumnDef="readdatetime">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="padding-left: 10px;"> Date </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;"> {{element.readdatetime}}
        </td>
      </ng-container>

      <ng-container matColumnDef="sendMachine">
        <th mat-header-cell *matHeaderCellDef mat-sort-header style="padding-left: 10px;">
          Status </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;">
          {{chageStatus(element.sendMachine)}}
      </ng-container>


      <ng-container matColumnDef="Action">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Action </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;">
          <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal"
            (click)="clickDetail(element)">
            รายการยา</button>

          <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#drugAllergy"
            (click)="clickAllergy(element.cid)" style="margin-left: 20px;" *ngIf="element.drugAllerg == 'Y'">
            รายการแพ้ยา</button>
        </td>


      </ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <div style="float: right;"><button mat-raised-button color="primary"
        (click)="exporter.exportTable('xlsx', {fileName:nameExcel, sheet: 'sheet_name', Props: {Author: 'Talha'}})">Export
        Excel</button>

    </div>
    <mat-paginator #MatPaginator="matPaginator" [length]="10" [pageSize]="10" [pageSizeOptions]="[10, 50, 100]"
      showFirstLastButtons>
    </mat-paginator>


    <!-- <table mat-table matTableExporter [dataSource]="dataSource" #MatSort="matSort" matSort #exporter="matTableExporter"
      class="mat-elevation-z8" matSortActive="createdDT" matSortDirection="desc">


      <ng-container matColumnDef="patientID">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> HN </th>
        <td mat-cell *matCellDef=" let element" style="padding-left: 20px;padding-right: 20px;"> {{element.hn}}
        </td>
      </ng-container>


      <ng-container matColumnDef="patientName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;">
          {{fixName(element.patientname)}}

        </td>
      </ng-container>



      <ng-container matColumnDef="createdDT">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Created </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;"> {{element.readdatetime}}
        </td>
      </ng-container>

      <ng-container matColumnDef="orderStatus">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;">
          {{chageStatus(element.sendMachine)}}
        </td>
      </ng-container>


      <ng-container matColumnDef="Action">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Action </th>
        <td mat-cell *matCellDef="let element" style="padding-left: 20px;padding-right: 20px;">
          <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal"
            (click)="clickDetail(element)">
            รายการยา</button>

          <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#drugAllergy"
            (click)="clickAllergy(element.cid)" style="margin-left: 20px;" *ngIf="element.drugAllerg == 'Y'">
            รายการแพ้ยา</button>
        </td>


      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <div style="float: right;" *ngIf="dataPharmacist"><button mat-raised-button color="primary"
        (click)="exporter.exportTable('xlsx', {fileName:nameExcel, sheet: 'sheet_name', Props: {Author: 'Talha'}})">Export
        Excel</button>

    </div>
    <mat-paginator style="display: flex;justify-content: center;" [length]="10" [pageSize]="10"
      [pageSizeOptions]="[10, 50, 100]" showFirstLastButtons>
    </mat-paginator> -->





  </div>



  <div class="modal fade" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">


        <div class="modal-header">
          <h4 class="modal-title">Detail</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>


        <div class="modal-body">

          <table class="table">

            <thead>

              <tr>
                <th style="  padding-right: 50px;border-right: 0px;">#</th>
                <th style="  padding-right: 50px;border-right: 0px">Code</th>
                <th style="  padding-right: 50px;border-right: 0px">Name</th>
                <th style="  padding-right: 50px;border-right: 0px">QTY</th>
                <th style="  padding-right: 50px;border-right: 0px">Unit</th>
                <th style="  padding-right: 50px;border-right: 0px">Created Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let i of dataDrug; let x = index">
                <td style="border-right: 0px">
                  <div style="width: 10px">{{x+1}}</div>
                </td>
                <td style="border-right: 0px">{{i.orderitemcode}}</td>
                <td style="border-right: 0px">{{i.orderitemname}}</td>
                <td style="border-right: 0px">{{numberQ(i.orderqty)}}</td>
                <td style="border-right: 0px">{{i.orderunitcode}}</td>
                <td style="border-right: 0px">{{i.ordercreatdate}}</td>
              </tr>
            </tbody>
          </table>


        </div>


        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

      </div>

    </div>
  </div>



  <div class="modal fade" id="drugAllergy">
    <div class="modal-dialog">
      <div class="modal-content">


        <div class="modal-header">
          <h4 class="modal-title">Detail</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>


        <div class="modal-body">
          <table class="table">

            <thead>

              <tr>
                <th style="  padding-right: 50px;border-right: 0px">#</th>
                <th style="  padding-right: 50px;border-right: 0px">Code</th>
                <th style="  padding-right: 50px;border-right: 0px">Name</th>

              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let i of dataDrug; let x = index">
                <td style="border-right: 0px">
                  <div style="width: 10px">{{x+1}}</div>
                </td>
                <td style="border-right: 0px">{{i.drugcode}}</td>
                <td style="border-right: 0px">{{i.drugname}}</td>
              </tr>
            </tbody>
          </table>


        </div>


        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

      </div>

    </div>
  </div>
