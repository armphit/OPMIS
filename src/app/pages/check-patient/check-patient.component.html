<div class="container-fluid mt-3">
  <h2 class="mb-4">üîç ‡∏™‡πÅ‡∏Å‡∏ô ID ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</h2>

  <div class="input-group mb-4">
    <input
      [(ngModel)]="patientId"
      type="text"
      class="form-control form-control-lg"
      placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô ID"
      (keyup.enter)="scan()"
    />
    <button class="btn btn-primary btn-lg" (click)="scan()">Scan</button>
  </div>

  <div *ngIf="patient.todayDrugsHN">
    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
    <mat-accordion class="mb-3" multi>
      <!-- <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß </mat-panel-title>
        </mat-expansion-panel-header>
        <p><strong>ID:</strong> {{ patient.id }}</p>
        <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> {{ patient.name }}</p>
        <p><strong>‡πÄ‡∏û‡∏®:</strong> {{ patient.gender }}</p>
        <p><strong>‡∏≠‡∏≤‡∏¢‡∏∏:</strong> {{ patient.age }} ‡∏õ‡∏µ</p>
      </mat-expansion-panel>


      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> üìá ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß </mat-panel-title>
        </mat-expansion-panel-header>
        <p><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</strong> {{ patient.citizenId }}</p>
        <p><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> {{ patient.address }}</p>
      </mat-expansion-panel> -->
      <mat-expansion-panel class="info-panel">
        <mat-expansion-panel-header>
          <mat-panel-title> üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ </mat-panel-title>
        </mat-expansion-panel-header>
        <div style="margin: 10px">
          <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
          <div class="info-grid contrainer">
            <div><strong>HN:</strong> {{ patient.todayDrugsHN[0]?.hn }}</div>
            <div>
              <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> {{ patient.todayDrugsHN[0]?.patientname }}
            </div>
            <div><strong>‡πÄ‡∏û‡∏®:</strong> {{ patient.todayDrugsHN[0]?.sex }}</div>
            <div>
              <strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</strong> {{ patient.todayDrugsHN[0]?.birthDay }}
            </div>
            <div>
              <strong>‡∏≠‡∏≤‡∏¢‡∏∏:</strong> {{ patient.todayDrugsHN[0]?.Age }} ‡∏õ‡∏µ
            </div>
          </div>

          <mat-divider></mat-divider>

          <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</div>
          <div class="info-grid">
            <!-- <div><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:</strong> {{ patient.todayDrugsHN[0]?.CardID }}</div> -->
            <div class="address">
              <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> {{ patient.todayDrugsHN[0]?.addr }}
            </div>
          </div>
        </div>
      </mat-expansion-panel>

      <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title> üíä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤ </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-card class="mb-3">
          <mat-card-content>
            <table
              mat-table
              [dataSource]="patient?.todayDrugsHN"
              class="mat-elevation-z1 w-100"
            >
              <ng-container matColumnDef="invName">
                <th mat-header-cell *matHeaderCellDef>‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤</th>
                <td mat-cell *matCellDef="let med">{{ med.invName }}</td>
              </ng-container>

              <ng-container matColumnDef="qtyReq">
                <th mat-header-cell *matHeaderCellDef>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <td mat-cell *matCellDef="let med">{{ med.qtyReq }}</td>
              </ng-container>

              <ng-container matColumnDef="unit">
                <th mat-header-cell *matHeaderCellDef>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                <td mat-cell *matCellDef="let med">{{ med.unit }}</td>
              </ng-container>

              <tr
                mat-header-row
                *matHeaderRowDef="['invName', 'qtyReq', 'unit']"
              ></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: ['invName', 'qtyReq', 'unit']"
              ></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </mat-expansion-panel>

      <!-- Check Card -->
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title> ‚úÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="row" style="padding: 10px">
          <div class="col-md-4 mb-3" *ngIf="patient.todayDrugsHN.length">
            <mat-card
              [ngClass]="{
                'bg-success text-white':
                  patient.finalResult?.allergymed[0]?.cid == null ||
                  patient.finalResult?.allergymed[0]?.cid === '' ||
                  (patient.finalResult?.allergymed[0]?.cid != null &&
                    patient.finalResult?.allergymed[0]?.cid !== '' &&
                    patient.finalResult?.allergymed[0]?.timestamp != null &&
                    patient.finalResult?.allergymed[0]?.timestamp !== ''),

                'bg-danger text-white':
                  patient.finalResult?.allergymed[0]?.cid != null &&
                  patient.finalResult?.allergymed[0]?.cid !== '' &&
                  (patient.finalResult?.allergymed[0]?.timestamp == null ||
                    patient.finalResult?.allergymed[0]?.timestamp === '')
              }"
              class="check-card mat-elevation-z2"
              style="cursor: pointer"
              (click)="patient.finalResult?.allergymed[0]?.cid && openDetail()"
            >
              <mat-card-title>‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏û‡πâ‡∏¢‡∏≤</mat-card-title>
              <mat-card-content> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: {{ allergyStatus }} </mat-card-content>
            </mat-card>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="staticBackdrop"
  data-backdrop="static"
  data-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Allergy</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-7">
            <span style="font-weight: bold; color: #f40000">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤</span>
            <div class="table-responsive">
              <table class="table table-danger">
                <thead>
                  <tr>
                    <!-- <th style="padding-right: 50px; border-right: 0px">
                            #
                          </th> -->
                    <!-- <th style="padding-right: 50px; border-right: 0px"></th> -->

                    <th style="padding-right: 50px; border-right: 0px">
                      ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
                    </th>
                    <th style="padding-right: 50px; border-right: 0px">
                      typedx
                    </th>
                    <th style="padding-right: 50px; border-right: 0px">
                      ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÅ‡∏û‡πâ‡∏¢‡∏≤
                    </th>
                    <!-- <th style="padding-right: 50px; border-right: 0px">
                            ‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏≤
                          </th> -->
                    <!-- <th style="padding-right: 50px; border-right: 0px">
                            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                          </th> -->
                    <th
                      class="sticky-col st-th"
                      style="padding-right: 50px; border-right: 0px"
                    >
                      ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="
                      let i of patient.finalResult?.allergymed;
                      let x = index
                    "
                  >
                    <!-- <td style="border-right: 0px; vertical-align: middle">
                            <div style="width: 10px">{{ x + 1 }}</div>
                          </td> -->

                    <td style="border-right: 0px; vertical-align: middle">
                      {{ i.hospName }}
                    </td>
                    <td
                      style="
                        border-right: 0px;
                        vertical-align: middle;
                        white-space: nowrap;
                      "
                    >
                      {{ i.typedx }}
                    </td>
                    <td
                      style="
                        border-right: 0px;
                        vertical-align: middle;
                        white-space: nowrap;
                      "
                    >
                      {{ i.allerglevelcode }}
                    </td>
                    <!-- <td
                            style="
                              border-right: 0px;
                              vertical-align: middle;
                              white-space: nowrap;
                            "
                          >
                            {{ i.drugcode }}
                          </td> -->

                    <!-- <td
                            style="
                              border-right: 0px;
                              vertical-align: middle;
                              white-space: nowrap;
                            "
                          >
                            {{ i.daterecord }}
                          </td> -->
                    <td
                      class="sticky-col st-td"
                      style="border-right: 0px; vertical-align: middle"
                    >
                      {{ i.drugname }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="col-5">
            <span style="font-weight: bold; color: #f40000">
              ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤
            </span>
            <div class="table-responsive">
              <table class="table table-danger">
                <thead>
                  <tr>
                    <!-- <th style="padding-right: 50px; border-right: 0px">
                            #
                          </th> -->
                    <!-- <th style="padding-right: 50px; border-right: 0px"></th> -->
                    <th style="padding-right: 50px; border-right: 0px">
                      ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤
                    </th>
                    <th style="padding-right: 50px; border-right: 0px">
                      ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤
                    </th>
                    <th style="padding-right: 50px; border-right: 0px">
                      ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏û‡πâ‡∏¢‡∏≤
                    </th>
                    <th style="padding-right: 50px; border-right: 0px">
                      ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="
                      let i of patient.finalResult?.allergymhr;
                      let x = index
                    "
                  >
                    <!-- <td style="border-right: 0px; vertical-align: middle">
                            <div style="width: 10px">{{ x + 1 }}</div>
                          </td> -->

                    <td
                      style="
                        border-right: 0px;
                        vertical-align: middle;
                        white-space: nowrap;
                      "
                    >
                      {{ i.drugName }}
                    </td>
                    <td
                      style="
                        border-right: 0px;
                        vertical-align: middle;
                        white-space: nowrap;
                      "
                    >
                      {{ i.ward_id }}
                    </td>
                    <td
                      style="
                        border-right: 0px;
                        vertical-align: middle;
                        white-space: nowrap;
                      "
                    >
                      {{ i.alergyType }}
                    </td>
                    <td
                      style="
                        border-right: 0px;
                        vertical-align: middle;
                        white-space: nowrap;
                      "
                    >
                      {{ i.causality }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Close
        </button>
        <button
          (click)="allergyConfirm()"
          *ngIf="!patient.finalResult?.allergymed[0]?.timestamp"
          type="button"
          class="btn btn-primary"
        >
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>
